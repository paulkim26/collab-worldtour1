--[[
    Author: GG3L (@GGÓ¡L)
    Script: Rotate
    Description: This script adds the ability to rotate any object on one or more axes, with the possibility to control the duration and speed.
    
    Permission is granted to use this script in custom rooms for Escape Simulator, provided that:
    - Credit is given to the author.
    - Neither this header nor the code is modified.

    Unauthorized distribution or modification is prohibited.
    All rights reserved by the author.
]]
if callType==LuaCallType.Init then a={}b=function(c,d,e)return math.max(d,math.min(c,e))end f=function(g,h)i={}for j in g:gmatch("%-?%d+%.?%d*")do table.insert(i,tonumber(j))end if h=='rotation' then for k,l in ipairs(i)do i[k]=b(l,-1,1)end elseif h=='speed' then for k,l in ipairs(i)do i[k]=b(l,1,5000)end elseif h=='stopRotation' then for k,l in ipairs(i)do i[k]=b(l,0,360)end elseif h=='increment' then for k,l in ipairs(i)do i[k]=b(l,0,360)end end return i end m=function(n)o=n:match("rotation:(.-);")p=n:match("speed:(.-);")q=n:match("stopRotation:(.-);")r=n:match("increment:(.-);")s=n:match("time:(.-);")t,u,v,w,x={},{},nil,nil,0 if o then t=f(o,"rotation")end if p then u=f(p,"speed")end if q and #q>0 then v=f(q,"stopRotation")end if r then w=f(r,"increment")end if s then x=b(s,0,3600)end return{x=t[1]or 0,y=t[2]or 0,z=t[3]or 0},{x=u[1]or 1,y=u[2]or 1,z=u[3]or 1},v and{x=v[1]or 0,y=v[2]or 0,z=v[3]or 0}or nil,w and{x=w[1]or 0,y=w[2]or 0,z=w[3]or 0}or nil,x or 0 end y=function(z,A,B,C)D=false for _,E in ipairs(a)do if E["\105\110\100\101\120"]==z then E["\105\115\82\111\116\97\116\105\110\103"]=true D=true break end end if not D then F,G,H,I,J=m(rotate[z]["\103\97\109\101\79\98\106\101\99\116"]["\71\101\116\67\111\109\112\111\110\101\110\116"]('\69\108\101\109\101\110\116')["\101\108\101\109\101\110\116\78\97\109\101"])table.insert(a,{["\105\110\100\101\120"]=z,["\111\114\105\103\105\110\97\108\82\111\116\97\116\105\111\110"]=rotate[z]["\116\114\97\110\115\102\111\114\109"]["\108\111\99\97\108\82\111\116\97\116\105\111\110"],["\116\97\114\103\101\116\82\111\116\97\116\105\111\110"]=F,["\116\97\114\103\101\116\83\112\101\101\100"]=G,["\115\116\111\112\82\111\116\97\116\105\111\110"]=H,["\105\110\99\114\101\109\101\110\116"]=I,["\116\105\109\101"]=J,["\105\115\82\111\116\97\116\105\110\103"]=true})end end K=function(L)for _,M in ipairs(a)do if M["\105\110\100\101\120"]==L then if M["\115\116\111\112\82\111\116\97\116\105\111\110"]then rotate[L]["\116\114\97\110\115\102\111\114\109"]["\108\111\99\97\108\82\111\116\97\116\105\111\110"]=Quaternion.Euler(M["\115\116\111\112\82\111\116\97\116\105\111\110"].x,M["\115\116\111\112\82\111\116\97\116\105\111\110"].y,M["\115\116\111\112\82\111\116\97\116\105\111\110"].z)end M["\105\115\82\111\116\97\116\105\110\103"]=false return end end end N=function(O)P=O["\103\97\109\101\79\98\106\101\99\116"]["\71\101\116\67\111\109\112\111\110\101\110\116"]('\69\108\101\109\101\110\116')Q=string.match(P["\112\108\97\121\101\114\86\97\114\105\97\98\108\101\78\97\109\101"],"{(%d+)}")return tonumber(Q)end R=function(S)if not S["\105\115\82\111\116\97\116\105\110\103"]and not S["\115\108\101\114\112\83\116\97\114\116\101\100"]then return end if not S["\105\110\99\114\101\109\101\110\116"]then T=S["\116\97\114\103\101\116\82\111\116\97\116\105\111\110"].x ~=0 and S["\116\97\114\103\101\116\83\112\101\101\100"].x*Time["\100\101\108\116\97\84\105\109\101"]*S["\116\97\114\103\101\116\82\111\116\97\116\105\111\110"].x or 0 U=S["\116\97\114\103\101\116\82\111\116\97\116\105\111\110"].y ~=0 and S["\116\97\114\103\101\116\83\112\101\101\100"].y*Time["\100\101\108\116\97\84\105\109\101"]*S["\116\97\114\103\101\116\82\111\116\97\116\105\111\110"].y or 0 V=S["\116\97\114\103\101\116\82\111\116\97\116\105\111\110"].z ~=0 and S["\116\97\114\103\101\116\83\112\101\101\100"].z*Time["\100\101\108\116\97\84\105\109\101"]*S["\116\97\114\103\101\116\82\111\116\97\116\105\111\110"].z or 0 rotate[S["\105\110\100\101\120"]]["\116\114\97\110\115\102\111\114\109"]["\108\111\99\97\108\82\111\116\97\116\105\111\110"]=rotate[S["\105\110\100\101\120"]]["\116\114\97\110\115\102\111\114\109"]["\108\111\99\97\108\82\111\116\97\116\105\111\110"]*Quaternion.Euler(T,U,V)else if not S["\115\108\101\114\112\83\116\97\114\116\101\100"]then W=Quaternion.AngleAxis(S["\105\110\99\114\101\109\101\110\116"].x*S["\116\97\114\103\101\116\82\111\116\97\116\105\111\110"].x,Vector3.right)X=Quaternion.AngleAxis(S["\105\110\99\114\101\109\101\110\116"].y*S["\116\97\114\103\101\116\82\111\116\97\116\105\111\110"].y,Vector3.up)Y=Quaternion.AngleAxis(S["\105\110\99\114\101\109\101\110\116"].z*S["\116\97\114\103\101\116\82\111\116\97\116\105\111\110"].z,Vector3.forward)S["\116\111\82\111\116\97\116\105\111\110"]=S["\111\114\105\103\105\110\97\108\82\111\116\97\116\105\111\110"]S["\116\111\82\111\116\97\116\105\111\110"]=W*S["\116\111\82\111\116\97\116\105\111\110"]S["\116\111\82\111\116\97\116\105\111\110"]=X*S["\116\111\82\111\116\97\116\105\111\110"]S["\116\111\82\111\116\97\116\105\111\110"]=Y*S["\116\111\82\111\116\97\116\105\111\110"]S["\115\108\101\114\112\83\116\97\114\116\101\100"]=true S["\116\105\109\101\67\111\117\110\116"]=0 end S["\116\105\109\101\67\111\117\110\116"]=S["\116\105\109\101\67\111\117\110\116"]+Time["\100\101\108\116\97\84\105\109\101"] Z=S["\116\105\109\101\67\111\117\110\116"]/S["\116\105\109\101"]rotate[S["\105\110\100\101\120"]]["\116\114\97\110\115\102\111\114\109"]["\108\111\99\97\108\82\111\116\97\116\105\111\110"]=Quaternion.Slerp(S["\111\114\105\103\105\110\97\108\82\111\116\97\116\105\111\110"],S["\116\111\82\111\116\97\116\105\111\110"],b(Z,0,1))if Z>=1 then S["\105\115\82\111\116\97\116\105\110\103"]=false S["\115\108\101\114\112\83\116\97\114\116\101\100"]=false rotate[S["\105\110\100\101\120"]]["\116\114\97\110\115\102\111\114\109"]["\108\111\99\97\108\82\111\116\97\116\105\111\110"]=S["\116\111\82\111\116\97\116\105\111\110"]S["\111\114\105\103\105\110\97\108\82\111\116\97\116\105\111\110"]=S["\116\111\82\111\116\97\116\105\111\110"]end end end end if callType==LuaCallType.Update then for _,E in ipairs(a)do if E then R(E)end end end if callType==LuaCallType.SwitchDone then if api.contains(switch,context)then z=N(context)if context.isOn then y(z)elseif not context.bounce then K(z)end end end
